---
title: "Relandscaping Analysis Template"
format: html
editor: visual
---

## Relandscaping Exploratory Analysis: Species

Winter 2024 - MCRS Advanced Quantitative Methods Class Project

Team #:

Team Members: Thomas, Audrey

#### Load Packages

```{r}
library(tidyverse)
library(vegan)
library(readr)
library(dplyr)
library(ggplot2)
library(PNWColors)
```

#### Import your Primary file from your saved .Rdata

```{r}
Vacuum_Primary <- read_csv("RelandscapingDataClean/Vacuum_Primary.csv")

load("RelandscapingDataClean/Vacuum_Primary.Rdata")

```

### Analysis

Before you begin, write your plan for analyzing this data. Add a header for each step you anticipate, then commit and push the document to Git. This may include steps such as:

-   calculating summarized variables (i.e., rates or change between time points, averages of replicated observations)

-   making figures to illuminate comparisons or relationships

-   testing assumptions and/or running models to test for significant comparisons or relationships

Never save over your Primary file. While you are playing around, only make edits under your own workspace header and on your own branch. By doing this, when you commit and push your changes to your shared repository, you avoid merge conflicts.

Once you have something good, show it to your teammates and you can agree to add it (by pasting into the chunk below) to your shared Team Analysis. The team member who updates the Team Analysis should then merge their branch with the master, and all teammates should do a fresh "pull", which will merge the new changes to your current working version. (if this is confusing, ask us for help)

#### Overall Goals

-   Create species presence/absence matrix using PlantSP and Code

-   

#### Setting Up Our Matrix

```{r}
VacRich <- Vacuum_Arthropods |>
  select(Sample_ID, code, count)

VacRich_Wide <- VacRich |> 
  pivot_wider(names_from = Sample_ID, values_from = count, values_fill = 0)

VacRich_Wide |> 
  pivot_longer(names_to = "Site", values_to = "Abund", cols = 2:ncol(VacRich_Wide)) |> 
  filter(Abund > 0) |> 
  group_by(Site) |> 
  count()

VacRich_Count <- VacRich_Wide |> 
  mutate_all(~ case_when(. > 0 ~ 1, . == 0 ~ 0)) |> 
  colSums() |>
  as.data.frame() |>
 rownames_to_column() |>
  separate(rowname, into = c('Naturalization', 'Species', 'Replicate'), sep = '_') |>
  rename(Species_Count = 'colSums(mutate_all(VacRich_Wide, ~case_when(. > 0 ~ 1, . == 0 ~ 0)))') |>
  slice(-1) |>
   mutate(Morphological_Pair = case_when(
      Species == "ROSOFF" | Species == "ERIFAS" ~ "ROSOFF-ERIFAS",
      Species == "RHAIND" | Species == "FRACAL" ~ "RHAIND-FRACAL",
      Species == "LAVGIN" | Species == "SALAPI" ~ "LAVGIN-SALAPI",
      Species == "ATLFES" | Species == "PENSPA" | 
      Species == 'MUHRIG' | Species == 'ELYCON' ~ 'GRASS',
      Species == "ACHTOM" | Species == "ACHMIL" ~ "ACHTOM-ACHMIL",
      .default = NA)
  )

  
#VacRich_Wide <- VacRich_Wide |>
 #mutate_if(is.character, as.numeric) |>
  #mutate(code = as.character(code))

VacDiv <- select(VacRich_Wide, -code) |>
diversity(index = "shannon", MARGIN = 2) |>
  as.data.frame() |>
   rownames_to_column() |>
  separate(rowname, into = c('Naturalization', 'Species', 'Replicate'), sep = '_') |>
  rename(Shannon_Div = 'diversity(select(VacRich_Wide, -code), index = "shannon", MARGIN = 2)') |>
  mutate(Morphological_Pair = case_when(
      Species == "ROSOFF" | Species == "ERIFAS" ~ "ROSOFF-ERIFAS",
      Species == "RHAIND" | Species == "FRACAL" ~ "RHAIND-FRACAL",
      Species == "LAVGIN" | Species == "SALAPI" ~ "LAVGIN-SALAPI",
      Species == "ATLFES" | Species == "PENSPA" | 
      Species == 'MUHRIG' | Species == 'ELYCON' ~ 'GRASS',
      Species == "ACHTOM" | Species == "ACHMIL" ~ "ACHTOM-ACHMIL",
      .default = NA))

 

```

#### Generating a Graph

```{r}
#SpeciesBar <- ggplot(VacRich_Count,
#      aes(x = Species, y = Species_Count, fill = Naturalization, color = Naturalization)) + 
#  geom_bar(stat = 'identity') +
#   facet_wrap(Naturalization~., scales = 'free_x') + 
#  labs(y = "Insect Species Count", x = "Plant Species", title = "Mean Arthropod Species Richness in Native and Non-Native Plant Species")

VacRich_NVNN <- ggplot(VacRich_Count,
       aes(x = Naturalization, y = Species_Count)) + 
  geom_boxplot() +
    labs(y = "Arthropod Species Richness", x = "Naturalization", title = "Arthropod Species Richness in Native and Non-Native Plant Species")

VacRich_Morph <- VacRich_Count |>
  filter(Morphological_Pair == 'LAVGIN-SALAPI') |>
  ggplot(
       aes(x = Species, y = mean(Species_Count), fill = Naturalization, color = Naturalization)) + 
  geom_bar(stat = 'identity') +
  labs(y = "Mean Arthropod Species Richness", x = "Plant Species", title = "Mean Arthropod Species Richness Between Same Morphological Groups")

#VacRich_Count |>
  #group_by(Species) |>
  #count()

VacDiv_NVNN <- ggplot(VacDiv,
       aes(x = Naturalization, y = Shannon_Div)) + 
  geom_boxplot() +
  labs(y = "Arthropod Shannon Diversity Index", x = "Naturalization", title = "Shannon Diversity Index in Native and Non-Native Plant Species")

VacDiv_Morph <- VacDiv |>
  filter(Morphological_Pair == 'LAVGIN-SALAPI') |>
  ggplot(
       aes(x = Species, y = mean(Shannon_Div), fill = Naturalization, color = Naturalization)) + 
  geom_bar(stat = 'identity') +
  labs(y = "Mean Arthropod Shannon Diversity Index", x = "Plant Species", title = "Shannon Diversity Index Between Same Morphological Groups")


VacRich_NVNN
VacRich_Morph
VacDiv_NVNN
VacDiv_Morph

```
